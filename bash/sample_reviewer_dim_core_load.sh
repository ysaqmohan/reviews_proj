#!/bin/bash

#./parms/.parms_env.sh

SDATE=`date`
STIME=`date +%s`
RUNDATE=`date +%C%y-%m-%d_%H.%M.%S`

PROJDIR="/edw/Reviews"
export PROJDIR
script_name="reviewer_dim_load"

log_file="$PROJDIR"/SourceCode/logs/"${script_name}-${RUNDATE}.log"
export log_file

. /$PROJDIR/SourceCode/parms/parms_env.sh

#function for capturing error
error_check ()
{
	if [ $? -gt 0 ]
	then 
		echo "Job Failed"
		echo "$log_file"
		exit 8
	fi
}

echo "###################################################################################################################################"  >> $log_file
echo "###################################################################################################################################"  >> $log_file
echo "Load to ODS in progress" >> $log_file
echo "###################################################################################################################################"  >> $log_file
echo "###################################################################################################################################"  >> $log_file                                                           

$PROJDIR/spark-2.4.5-bin-hadoop2.7/bin/spark-submit $PROJDIR/SourceCode/python/$script_name.py >> $log_file 2>&1 
error_check

echo "###################################################################################################################################"  >> $log_file
echo "###################################################################################################################################"  >> $log_file
echo "Job completed successfully" >> $log_file
echo "###################################################################################################################################"  >> $log_file
echo "###################################################################################################################################"  >> $log_file
